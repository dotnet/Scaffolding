{
  "Identifier": "dotnet-minimal_webapi",
  "Files": [
    {
      "FileName": "Program.cs",
      "Usings": [
        "Microsoft.AspNetCore.Authentication",
        "Microsoft.AspNetCore.Authentication.JwtBearer",
        "Microsoft.Identity.Web",
        "Microsoft.Identity.Web.Resource"
      ],
      "Methods": {
        "Global": {
          "CodeChanges": [
            {
              "Block": "builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)\r\n    .AddMicrosoftIdentityWebApi(builder.Configuration.GetSection(\"AzureAd\"));",
              "Prepend": true,
              "InsertBefore": [ "builder.Services.AddAuthorization", "builder.Services.AddEndpointsApiExplorer", "builder.Services.AddSwaggerGen" ],
              "CodeFormatting": {
                "Newline": true
              }
            },
            {
              "Block": "builder.Services.AddAuthorization();",
              "InsertAfter": "builder.Services.AddAuthentication",
              "InsertBefore": [ "builder.Services.AddEndpointsApiExplorer", "builder.Services.AddSwaggerGen" ],
              "CodeFormatting": {
                "Newline": true
              }
            },
            {
              "Block": "EnableTokenAcquisitionToCallDownstreamApi()",
              "Parent": "AddMicrosoftIdentityWebApi",
              "CodeChangeType": "MemberAccess",
              "Options": [ "MemberAccess", "MicrosoftGraph", "DownstreamApi" ]
            },
            {
              "Block": "AddMicrosoftGraph(builder.Configuration.GetSection(\"MicrosoftGraph\"))",
              "Parent": "EnableTokenAcquisitionToCallDownstreamApi",
              "CodeChangeType": "MemberAccess",
              "Options": [ "MicrosoftGraph" ],
              "CodeFormatting": {
                "NumberOfSpaces": 12,
                "Newline": true
              }
            },
            {
              "Block": "AddDownstreamWebApi(\"DownstreamApi\",builder.Configuration.GetSection(\"DownstreamApi\"))",
              "Parent": "EnableTokenAcquisitionToCallDownstreamApi",
              "CodeChangeType": "MemberAccess",
              "Options": [ "MemberAccess", "DownstreamApi" ],
              "CodeFormatting": {
                "NumberOfSpaces": 12,
                "Newline": true
              }
            },
            {
              "Block": "AddInMemoryTokenCaches()",
              "Parent": "AddDownstreamWebApi",
              "CodeChangeType": "MemberAccess",
              "Options": [ "MemberAccess", "DownstreamApi" ],
              "CodeFormatting": {
                "NumberOfSpaces": 12,
                "Newline": true
              }
            },
            {
              "Block": "AddInMemoryTokenCaches()",
              "Parent": "AddMicrosoftGraph",
              "CodeChangeType": "MemberAccess",
              "Options": [ "MemberAccess", "MicrosoftGraph" ],
              "CodeFormatting": {
                "NumberOfSpaces": 12,
                "Newline": true
              }
            },
            {
              "Block": "app.UseAuthentication();",
              "InsertAfter": "app.UseHttpsRedirection",
              "InsertBefore": [
                "app.UseAuthorization",
                "app.MapGet"
              ],
              "CodeFormatting": {
                "Newline": true
              }
            },
            {
              "Block": "app.UseAuthorization();",
              "InsertAfter": "app.UseAuthentication",
              "InsertBefore": [
                "var summaries",
                "app.MapGet",
                "app.Configuration["
              ],
              "CodeFormatting": {
                "Newline": true
              }
            },
            {
              "Block": "var scopeRequiredByApi = app.Configuration[\"AzureAd:Scopes\"];", 
              "InsertAfter": "app.UseAuthorization",
              "InsertBefore": [
                "var summaries",
                "app.MapGet"
              ],
              "CodeFormatting": {
                "Newline": true
              }
            },
            {
              "Block": "HttpContext httpContext",
              "Parent": "app.MapGet",
              "CodeChangeType": "LambdaParameter"
            },
            {
              "Block": "httpContext.VerifyUserHasAnyAcceptedScope(scopeRequiredByApi);",
              "Parent": "app.MapGet",
              "CodeChangeType": "InLambdaBlock",
              "Prepend": true,
              "CodeFormatting": {
                "Newline": true
              }
            },
            {
              "Parent": "app.MapGet",
              "CodeChangeType": "MemberAccess",
              "Block": "RequireAuthorization()",
              "CodeFormatting": {
                "Newline": true
              }
            }
          ]
        }
      }
    }
  ] 
}
